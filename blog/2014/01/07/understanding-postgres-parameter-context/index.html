
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Understanding Postgres Parameter Context - Postgres and other musings</title>
  <meta name="author" content="Gurjeet Singh">

  
  <meta name="description" content="Postgres&#8217; parameters have an associated context, which determines when that
parameter can be changed. You can see the context of every &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://gurjeet.singh.im/blog/2014/01/07/understanding-postgres-parameter-context">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="Postgres and other musings" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3137805-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">Postgres and other musings</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:gurjeet.singh.im/blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Understanding Postgres Parameter Context</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-07T21:55:21+00:00" pubdate data-updated="true">Jan 7<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Postgres&#8217; parameters have an associated context, which determines when that
parameter can be changed.</p>

<p>You can see the context of every parameter using the following query. A sample
output is also shown.</p>

<pre><code>select name, context from pg_settings order by category;

              name               |  context   
---------------------------------+------------
 autovacuum_freeze_max_age       | postmaster
 autovacuum_max_workers          | postmaster
 autovacuum_vacuum_threshold     | sighup
 ...
 IntervalStyle                   | user
 ...
 server_encoding                 | internal
 ...
 lc_messages                     | superuser
 ...
 local_preload_libraries         | backend
 ...
</code></pre>

<p>The possible values of context are:</p>

<ul>
<li>internal (called <code>PGC_INTERNAL</code> in source code)</li>
<li>postmaster (<code>PGC_POSTMASTER</code>)</li>
<li>sighup (<code>PGC_SIGHUP</code>)</li>
<li>backend (<code>PGC_BACKEND</code>)</li>
<li>superuser (<code>PGC_SUSET</code>)</li>
<li>user (<code>PGC_USERSET</code>)</li>
</ul>


<p>The above list is in order of when a parameter can be set; if a parameter can be
changed in a certain context, then it can be changed at any of the earlier
contexts as well.</p>

<h3>internal</h3>

<p>The <code>internal</code> parameters cannot be changed; these are usually compile-time
constants. If you want to change any of these, you&rsquo;ll have to change it in
Postgres source code and compile a new set of Postgres executables.</p>

<h3>postmaster</h3>

<p>The <code>postmaster</code> parameters can be set at Postgres startup, or during source code
compilation. (Postmaster is the parent process of all the Postgres processes,
hence the context&rsquo;s name).</p>

<p>These parameters can be set in the <code>postgresql.conf</code> file or on the command-line
when starting the Postgres server.</p>

<h3>sighup</h3>

<p>The <code>sighup</code> parameters can be changed while the server is running, at Postgres
startup, or during code compilation.</p>

<p>To change such a parameter, you can change it in the <code>postgresql.conf</code> file and send a
<code>SIGHUP</code> signal to the Postmaster process. An easy way to send the <code>SIGHUP</code> signal
to the Postmaster process is to use <code>pg_ctl</code> or your distribution&rsquo;s Postgres-init
script, like so:</p>

<pre><code>pg_clt -D $PGDATA reload
</code></pre>

<p>OR</p>

<pre><code>sudo service postgresql-9.3 reload
</code></pre>

<h3>backend</h3>

<p>The <code>backend</code> parameters can be changed/set while making a new connection to
Postgres, and never after that (and these can be changed by <code>SIGHUP</code>, at Postgres
startup, or during code compilation).</p>

<p>Usually the applications set these parameters while making the initial connection.</p>

<p>An example is the <code>local_preload_libraries</code> parameter. Say, if you want to try a
plugin for just one session, then you can initiate a <code>psql</code> session, with that
plugin loaded for the connection, like so:</p>

<pre><code>PGOPTIONS="-c local_preload_libraries=my_plugin" psql
</code></pre>

<p>The above method of changing parameters is possible for any application that
uses <code>libpq</code> library to connect to Postrges (for eg. <a href="http://pgadmin.org/">pgAdmin</a>), since the <code>PGOPTIONS</code>
environment variable is recognized and honored by <code>libpq</code>. Other applications/libraries
may have their own methods to allow changing parameters during connection initiation.</p>

<h3>superuser</h3>

<p>To change a <code>superuser</code> parameter, one needs to have <code>superuser</code> privileges in Postgres.
These parameters can be changed while a session is in progress, during a backend
startup, using <code>SIGHUP</code>, at Postgres startup, or during code compilation.</p>

<p>Note that normal users cannot change these parameters.</p>

<h3>user</h3>

<p>The parameters with <code>user</code> context can be changed by any user, at any time, to
affect the current session they are connected to. Needless to say that since this
is the last context in the list, a parameter that is marked as <code>user</code> context, can be changed
using any of the methods shown for the other contexts.</p>

<p>The <code>SET</code> command can be used to change a <code>user</code> context parameter&rsquo;s value, for eg.:</p>

<pre><code>SET work_mem = '32 MB';
</code></pre>

<h2>Using context in queries</h2>

<p>Although, as explained above, there is a certain order in the values of <code>context</code>,
there is no built-in way for one to see this order, and exploit that knowledge
using queries.</p>

<p>Say, if one wants to see a list of all parameters that cannot be
changed by a normal user, there&rsquo;s no straightforward way to do it. To that end,
I create the following <code>enum</code> type and use it in queries to extract that information easily:</p>

<pre><code>create type guc_context as enum (
    'internal',
    'postmaster',
    'sighup',
    'backend',
    'superuser',
    'user');

select name as cannot_be_changed_by_user, context
from pg_settings
where context::guc_context &lt; 'user';
</code></pre>

<p>Other useful information that can now be easily extracted using this <code>enum</code>:</p>

<pre><code>select name as parameter,
    context_enum &gt; 'internal' as can_be_changed,
    context_enum = 'postmaster' as change_requires_restart,
    context_enum &gt;= 'sighup' as can_be_changed_by_reload
from (select name, context::guc_context as context_enum
    from pg_settings) as v;

            parameter            | can_be_changed | change_requires_restart | can_be_changed_by_reload 
---------------------------------+----------------+-------------------------+--------------------------
 allow_system_table_mods         | t              | t                       | f
 application_name                | t              | f                       | t
 archive_command                 | t              | f                       | t
 archive_mode                    | t              | t                       | f
 archive_timeout                 | t              | f                       | t
 array_nulls                     | t              | f                       | t
 authentication_timeout          | t              | f                       | t
 ...
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Gurjeet Singh</span></span>

      








  


<time datetime="2014-01-07T21:55:21+00:00" pubdate data-updated="true">Jan 7<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/administration/'>Administration</a>, <a class='category' href='/blog/categories/postgres/'>Postgres</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="/blog//twitter.com/share" class="twitter-share-button" data-url="http://gurjeet.singh.im/blog/2014/01/07/understanding-postgres-parameter-context/" data-via="singh_gurjeet" data-counturl="http://gurjeet.singh.im/blog/2014/01/07/understanding-postgres-parameter-context/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/blog/2014/01/21/hibernating-and-restoring-postgres-buffer-cache/" title="Next Post: Hibernating and Restoring Postgres Buffer Cache">Hibernating and Restoring Postgres Buffer Cache &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/23/announcing-tpc-c-dot-js-a-lightweight-implementation-of-tpc-c/">Announcing TPC-C.js; a Lightweight Implementation of TPC-C</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/30/postgres-hibernator-reduce-planned-database-down-times/">Postgres Hibernator: Reduce Planned Database Down Times</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/23/google-maps-boston-plane-in-flight/">Google Maps Boston Plane In-flight</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/03/introducing-postgres-hibernator/">Introducing Postgres Hibernator</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/21/hibernating-and-restoring-postgres-buffer-cache/">Hibernating and Restoring Postgres Buffer Cache</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/gurjeet">@gurjeet</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/blog/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'gurjeet',
            count: 2,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/+GurjeetSinghK?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Gurjeet Singh -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'gurjeet-singh-im-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://gurjeet.singh.im/blog/2014/01/07/understanding-postgres-parameter-context/';
        var disqus_url = 'http://gurjeet.singh.im/blog/2014/01/07/understanding-postgres-parameter-context/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
